<html><head><title>Ciris: Logging Configurations</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Viktor Lövgren" /><meta name="description" content="Lightweight, extensible, and validated configuration loading in Scala" /><meta name="og:image" content="/img/poster.png" /><meta name="og:title" content="Ciris: Logging Configurations" /><meta name="og:site_name" content="Ciris" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Lightweight, extensible, and validated configuration loading in Scala" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Ciris: Logging Configurations" /><meta name="twitter:image" content="img/poster.png" /><meta name="twitter:description" content="Lightweight, extensible, and validated configuration loading in Scala" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@vlovgr" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><link rel="stylesheet" href="/css/custom.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Ciris</span></div></a></li> <li><a href="/docs/basics" class="">Usage Basics</a></li> <li><a href="/docs/topics" class="">Configuration Topics</a> <ul class="sub_section"> <li><a href="/docs/validation" class="">Encoding Validation</a></li> <li><a href="/docs/environments" class="">Multiple Environments</a></li> <li><a href="/docs/logging" class=" active ">Logging Configurations</a></li></ul></li> <li><a href="/docs/sources" class="">Configuration Sources</a> <ul class="sub_section"> <li><a href="/docs/supported-sources" class="">Current Supported Sources</a></li> <li><a href="/docs/supporting-new-sources" class="">Supporting New Sources</a></li></ul></li> <li><a href="/docs/decoders" class="">Configuration Decoders</a> <ul class="sub_section"> <li><a href="/docs/supported-types" class="">Current Supported Types</a></li> <li><a href="/docs/supporting-new-types" class="">Supporting New Types</a></li></ul></li> <li><a href="/docs/modules" class="">Modules Overview</a> <ul class="sub_section"> <li><a href="/docs/cats-module" class="">Cats Module</a></li> <li><a href="/docs/cats-effect-module" class="">Cats Effect Module</a></li> <li><a href="/docs/enumeratum-module" class="">Enumeratum Module</a></li> <li><a href="/docs/generic-module" class="">Generic Module</a></li> <li><a href="/docs/refined-module" class="">Refined Module</a></li> <li><a href="/docs/spire-module" class="">Spire Module</a></li> <li><a href="/docs/squants-module" class="">Squants Module</a></li></ul></li> <li><a href="/docs/contributing" class="">Contributing Guide</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/vlovgr/ciris"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/vlovgr/ciris"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="vlovgr" data-github-repo="ciris"><div class="content-wrapper"><section><h1 id="logging-configurations">Logging Configurations</h1>
<p>Configuration logging can quickly help you determine which values are being used by the application, and can aid with debugging whenever things go wrong. Since configurations often contain secret values – avoiding having secrets in code being one of the main use cases for configurations – we would like to avoid having these secrets included in any logs. Ciris provides the <a href="/api/ciris/Secret.html"><code class="highlighter-rouge">Secret</code></a> wrapper type for this purpose. By wrapping your secret configuration values in <a href="/api/ciris/Secret.html"><code class="highlighter-rouge">Secret</code></a>, we can avoid  accidentally including them in logs.</p>

<p>For example, let’s take a look at the following configuration, where the <code class="highlighter-rouge">ApiKey</code> is secret. We’re using refinement types to encode validation in the types of our values, refer to the <a href="/docs/validation">encoding validation</a> section for more information. Note that the <code class="highlighter-rouge">ApiKey</code> in the example below would normally be loaded from, for example, a vault service – unless the value itself is not considered a secret, for example, if it was used for testing purposes.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ciris.Secret</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.api.Refined</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.auto._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.string.MatchesRegex</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.types.net.UserPortNumber</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.types.numeric.PosInt</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.types.string.NonEmptyString</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.W</span>

<span class="k">type</span> <span class="kt">ApiKey</span> <span class="o">=</span> <span class="nc">String</span> <span class="nc">Refined</span> <span class="nc">MatchesRegex</span><span class="o">[</span><span class="kt">W.`</span><span class="err">"</span><span class="o">[</span><span class="kt">a-zA-Z0-</span><span class="err">9</span><span class="o">]{</span><span class="err">25</span>,<span class="err">40</span><span class="o">}</span><span class="err">"</span><span class="kt">`.T</span><span class="o">]</span>

<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">ApiConfig</span><span class="o">(</span>
  <span class="n">key</span><span class="k">:</span> <span class="kt">Secret</span><span class="o">[</span><span class="kt">ApiKey</span><span class="o">],</span>
  <span class="n">port</span><span class="k">:</span> <span class="kt">UserPortNumber</span><span class="o">,</span>
  <span class="n">timeoutSeconds</span><span class="k">:</span> <span class="kt">PosInt</span>
<span class="o">)</span>

<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Config</span><span class="o">(</span>
  <span class="n">appName</span><span class="k">:</span> <span class="kt">NonEmptyString</span><span class="o">,</span>
  <span class="n">api</span><span class="k">:</span> <span class="kt">ApiConfig</span>
<span class="o">)</span>

<span class="k">val</span> <span class="n">config</span> <span class="k">=</span>
  <span class="nc">Config</span><span class="o">(</span>
    <span class="n">appName</span> <span class="k">=</span> <span class="s">"my-api"</span><span class="o">,</span>
    <span class="n">api</span> <span class="k">=</span> <span class="nc">ApiConfig</span><span class="o">(</span>
      <span class="n">key</span> <span class="k">=</span> <span class="nc">Secret</span><span class="o">(</span><span class="s">"RacrqvWjuu4KVmnTG9b6xyZMTP7jnX"</span><span class="o">),</span>
      <span class="n">timeoutSeconds</span> <span class="k">=</span> <span class="mi">10</span><span class="o">,</span>
      <span class="n">port</span> <span class="k">=</span> <span class="mi">4000</span>
    <span class="o">)</span>
  <span class="o">)</span>
</code></pre>
</div>

<p>The perhaps easiest way to log the configuration is to use <code class="highlighter-rouge">println</code>. As you can see in the example below, the secret configuration value is replaced with a <code class="highlighter-rouge">Secret(***)</code> placeholder when printed, while the remaining values of the configuration are printed with their <code class="highlighter-rouge">toString</code> representations as expected.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">println</span><span class="o">(</span><span class="n">config</span><span class="o">)</span>
<span class="c1">// Config(my-api,ApiConfig(Secret(***),4000,10))
</span></code></pre>
</div>

<h2 id="logging-improvements">Logging Improvements</h2>
<p>Relying on <code class="highlighter-rouge">toString</code> works reasonably well for small configurations, like in the example shown above, but as your configuration grows in size, it can be considerably more difficult to determine which value is which in the output. Making use of <code class="highlighter-rouge">toString</code> also means we’re relying on every type having implemented an appropriate <code class="highlighter-rouge">toString</code> function, which might not always be the case.</p>

<p>As an alternative, we can make use of the <a href="https://typelevel.org/cats/typeclasses/show.html"><code class="highlighter-rouge">Show</code></a> type class from <a href="/docs/cats-module">cats</a>. However, we would still like to avoid having to manually define the <a href="https://typelevel.org/cats/typeclasses/show.html"><code class="highlighter-rouge">Show</code></a> behaviour for all the types in the configuration. Luckily, we can use <a href="https://github.com/milessabin/kittens">kittens</a>, which in turn uses <a href="https://github.com/milessabin/shapeless">shapeless</a> to provide generic derivation of type class instances for <a href="https://typelevel.org/cats/typeclasses/show.html"><code class="highlighter-rouge">Show</code></a>. The <a href="https://typelevel.org/cats/typeclasses/show.html"><code class="highlighter-rouge">Show</code></a> instances derived by <a href="https://github.com/milessabin/kittens">kittens</a> also include the field names of our <code class="highlighter-rouge">case class</code>es, so it’s easier to see which configuration value is which in the output. If we’re using refinement types, there’s a <code class="highlighter-rouge">refined-cats</code> module which provides <a href="https://typelevel.org/cats/typeclasses/show.html"><code class="highlighter-rouge">Show</code></a> instances for refinement types.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.Show</span>
<span class="k">import</span> <span class="nn">cats.derived._</span>
<span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="k">import</span> <span class="nn">ciris.cats._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.cats._</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">showConfig</span><span class="k">:</span> <span class="kt">Show</span><span class="o">[</span><span class="kt">Config</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">auto.show._</span>
  <span class="n">semi</span><span class="o">.</span><span class="n">show</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">println</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="n">show</span><span class="o">)</span>
<span class="c1">// Config(appName = my-api, api = ApiConfig(key = Secret(***), port = 4000, timeoutSeconds = 10))
</span></code></pre>
</div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/js/custom.js"></script><script>((window.gitter = {}).chat = {}).options = {
room: 'vlovgr/ciris'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/main.js"></script></body></html>